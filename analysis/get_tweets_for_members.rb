require '../config/environment'
members = %w(SpiroDavis ChareeKlimek ibranding CristianSaracco lucasmelb BridgetAyers joegreenz MattandTamsen MVRDV archfeeds archnow ArchitectLeague archquotes architonic DomusWeb aplust_arch parq Talkitect DesignMuseum abitare architecturelab eVoloMagazine worldarchnews BDonline HOKNetwork worldarchfest RIBAJ ArchFoundation pubarch BjarkeIngels formfollowshome ArchitypeReview forarchitects HarvardGSD sankakucomplex NY_Anime_Fest animecentral digitalmanga SentaiFilmworks Quotes_Anime aniplexUSA CMXmanga madoka_magica mangastream animeevolution Vertical_Ed animepro hosodamamoru Otakon kyonkun comic_natalie cowboybibimbop predederva animefriends animebuzz AnimeOnLunch Naruto_News johnnyyongbosch andrea_chii Emiryun AngelTouchPlus ANN_Bamboo FUNiChan bigmovingstock FouStockPicks ExpressSupport ecobeautiful wedding_network carleyroney myweddingideas grace_ormonde DavidTutera wedding_shoppe TerrapinBeerCo CharliePapazian GLBC_Cleveland Schlafly thefullpint OdellBrewing hoppinfrog AbbeyStMartin sweetwaterbrew HeavySeasBeer surlybrewing Redhook_Brewery peakbrewing TheAbitaBeer Beer_Info MoylansBrewery beerevents ithacabeer BrewersAssoc newbelgiumbeer TheBeerWench BluePointBrewer GreenFlashBeer smuttynosebeer BeerMagazine IronHillBrewery craftbeerdotcom Weyerbacher elal_airlines BMWORACLE2010 valenciasailing millarmind Roman86_K allandavis27 jakob_fuglsang StueyOG michaelibarry marcopinotti mattgoss1986 manuelquinziato spokesmen stevendejongh brentbookwalter RobbieVentura BenKing89 swiftybswift NASAFermiTelscp BrianWilson38 davidortiz CarlCrawford_ KenTremendous JUS10UP10 TheGarfoose Yankees BJUPTON2 orlandohudson Joba_62 HunterPence3 cgrand14 mattkemp27 MLBRumorCentral DrewStoren RedSox thisisdspan YankeesWFAN JoeNathan36 Mariners Coco_Crisp caniszczyk TheCharlieDay ESPN_CollHoops mogotti25 Maggianos PFChangs McandSchmicks pizzahut DunkinDonuts Wendys calpizzakitchen PapaJohns RoysRestaurants SJRestaurant BOURBONSTEAKDC ChipotleTweets eatersf dominos MatchboxDC Clydes DairyQueen midtownlunch centralmr MarcelsBeckDC EquinoxDC jimmyjohns pingpongdc PolicyDC Historypin RealTimeWWII publichistorian archivesnews LondonHistorian foundhistory JQAdams_MHS ArchiveAtBBC The18thCentury NASAhistory HistoryMatters historyscientis Amanda_Vickery MedievalWall RoutledgeHist History_Now HandmadeNewsorg MGMarts GemmaWildLondon isamocrochet yoyocottage EtsyBagalicious evihan ShopHandmadeUK whipup ErikaPrice official_tWitch kingofkrump AlexdWong mKiK808 Billy_Bell DANCEonFOX Allisonholker brianfriedman JONATHANLEGACY ADEEVERYDAY Ellenore BenjiSchwimmer KathrynrMcc laurenfrodie alohakupono Katee_Shean MollsGrayy KaylaRadomski4 I_BrandonBryant jakobakarr catdeeley RJRoldan iamboomkack JManrara sjtookey CourtneyGaliano Joshu_Allen Kent_Boyd ComfortIVREAL NickLazzarini msdebbieallen Tillesuk CodeIgniter phpmagazin phpa zendcasts cakephp PHPClassesEarly WebinarsatZend PHPWomen manuelp afup davidchoimusic KristinaHorner AmazingPhil Supermac18 kylesibert Strawburry17 AndrewBravener 3sixty5days Nanalew wongfupro Onision fwong shutupbuck bubzbeauty DulceCandy87 melissatrippy fluffeetalks MattG124 BrettTheIntern catrific nicepeter josephbirdsong jeyyounit11 Nanas08 500 WebCPAtweets RebeccaTervoCPA VirtualCpaLisa sohmer choochoobear dresdencodak wigu lartist ZachWeiner nedroid hanneloreEC drhastings TimCAD fayewhitaker ErikaMoen martenreed dorabianchi hawkster badmachinery penelopegaines svenbianchi davekellett guigar pintsize0101 Shortpacked ananthymous gunnerkrigg marigoldfarmer tai_fighter joeycomeau XxSexyRavenxX aidosaur macappstorm panic 1Password daringfireball MacFan mactip Cabel MacObserver pschiller macosrumors digg_applenews siracusa danfrakes theappleblog yamamura stevewoz alfredapp MacOtakaraRSS macstoriesnet NowReport TheMacalope scottstevenson MacUpdate forstall iTunesJapan taisy0 officeformac themacbuzzer MacGeneration BodyofBreen smokingapples Adium maczot TextExpander adamengst VMwareFusion macupdatepromo iTunesMusic optp 350 nytimesdining TheAtlanticLIFE food52news tmaemarketing IntegralYoga HathaYogaBoy YogaClassPlan Yoga_Living ashtangayoga itsallyoga_baby WanderlustFest yoga_girl_today jerseycorn1 Flowyogamag streetyoga YogaTree ElenaBrower yogalivingspace ARedLotus AshleyTurner1 bepresentinc JivamuktiNYC YogaLifeStyIe MCYogi108 OFFTHEMATYOGA YoginiYates ZakkWyldeBLS JPetrucci JBONAMASSA FenderGBI MartinGuitar VOXamps DiMarzioInc EHX Richie_Kotzen SuhrCustom MarshallAmps Ibanez_USA thepedalnerd tommyemmanuel GibsonGuitarUK orianthi tmorello 300guitars greghoweguitar Daddariostrings GretschGuitars guitaredge parkerguitar ElixirStrings DaveMustaine Gtrintlmag PRSGuitar Cort_Guitars FernandesUSA GodinGuitars funguitarpickin EMG_PICKUPS ASPCA howardlake pbarclaytimes GeorgeCaulkin PaulHayward_gnm oreillyfactor USATYourLife tomiahonen Symbian MobileMW nokiabetalabs mobileindustry ovibynokia nokiadeveloper mobilitycompany sprint janole FlurryMobile andreascon MCommerceDaily MobileEntBiz peggyanne qtproject OviDeveloper TuXapuntes brlinux ubuntizando usemoslinux commandlinefu10 n00bsonubuntu jolicloud ubuntudicas NYTimesDealBook TonyVowles adastrology darkastr cuspects ConstructionNY Kinoplex iTunesTrailers LaisBodanzky UCICinemas TheAcademy Cinemaeafins Bonequinho RioFilme sessoes mausaldanha EverythingEtsy EtsyTwitrTeam Blackenedruby ByHappyGoLicky CraftAssistant lizzibooonetsy ErikaPrice mamlamarquise higdonmarathon AskMiles TheTrailJogger nikeplus ChrisSolinsky Vibram5Fingers THESFMARATHON LondonMarathon WBZmarathon runnersworlduk nyrrmaryruns lolojones sirisaac karagoucher laurenfleshman Oblinkin salomon_running newbalance Marine_Marathon NikeRunning idiotrunner Partnerunning BarefootTed sarahstanley McDougallChris tandfn 350 TheSirNickFaldo The_Open_Champ Theprincedc WEUnderstudies johnowenjones danielboys raminkarimloo londonwestend Spiceboy81 lesmisofficial BristolOldVic ATGTICKETS Gina_Beck AlfieBoe EquityUK Sheridansmith1 wickedlondon RustySurfboards markcoker Weegee RonHogan JFbookman Borders OpenRoadMedia THEREALSWIZZZ icecube PRODIGYMOBBDEEP RapperBigPooh MeekMill TonyYayo Mr_Camron therealredman MissyElliott MickeyFactz Yelawolf VADO_MH LilKim Phillyfreezer MistahFAB RevRunWisdom Pixiwoos VeggieGardens gardeningguru BG_garden gardeningtricks GW_com ogmag margaretroach OurLittleAcre kissmyaster heavy_petal Garden_Expert TeleGardening HelenYoest kewgardens myfolia GardenDesignMag GardenWow notsogreenthumb cbGardening gardennetwork GardenWiseInc hortweek punkrockgardens gardenwise GardenMag cityslipper dobbiesdotcom AnniesAnnuals veggiegarden1 PoemsAPlenty PoetrySociety Poetry_Daily Semaphore Toltecjohn ByLeavesWeLive poetswritersinc poetshouse anonpoetry PoetryBookSoc magmapoetry TheOpenField harriet_poetry thepoetrytrust PoeticHeart34 Jemfyr StAnzaPoetry coffeetablepoet PoetryArchive PoetryDayUK amoz1939 graftpoetry tinylittlepoems forgottenworks muse_daily beezknez CoyoteSings christianbok yearning4d_sky poetryschool escarp PoetCasting DarkHaikuMoon ThoseThr3Words CarryAPoem ponyups gennepher TheSmokingPoet poetryblog robertleebrewer wordblender iwritepoetry Jannagae kujakupoet RavenClause rattlepoetry paradoxicali ericcoliu monkeywillow PoetsPages usatinteractive seibe10 BearGrylls PacificNPS CampingGearTV Polartec forestservice OutdoorNation THEYosemiteBlog OhRanger NatGeoTraveler SeattleBackpack WTA_hikers Big_Agnes YellowstoneNPS slmandel YahooForde ESPN_SEC schadjoe MrCFB bigtenconf PeteThamelNYT Andy_Staples BFeldmanCBS AP_Top25 pac12 dartmouth Ivan_Maisel Cornell_Univ CollegeGameDay Big12Conference ESPNHomeCourt CollegeChat BrynMawrCollege cbfowler RhodesCollege CFBLIVE finebaum NCStateNews NCAA EmoryUniversity MattRHinton mtholyoke HamiltonCollege SpelmanCollege WheatonCollege BucknellU theACC WMNews CollegeBlogs DanWetzel jppalm ESPN_BigTen ESPN_Pac12blog ESPN_ACC CFTalk rofters HospitalityWN GuestPulse GuestReferrals RealIsildur1 JosephHachem TonyGuoga)
members.each do |member|
  person = Person.find_by_username(member)
  begin
    #puts "enque person #{person.id}"
    Delayed::Job.enqueue(CollectAllFeedEntriesJob.new(person.id))
  rescue
    puts "could not find #{member}"
  end      
end

continue = true
while continue
  found_pending_jobs = 0				
  Delayed::Job.all.each do |job|			
    if job.handler.include? "CollectAllFeedEntriesJob"
            found_pending_jobs += 1
    end
    if job.attempts >= 4
            puts "#{Project.get_remaining_hits}. Deleting job with more than #{job.attempts} attempts."
            job.delete				
    end
  end
  if found_pending_jobs == 0
    continue = false
  end
  puts "Tweet Collection: #{Project.get_remaining_hits}. Waiting for #{found_pending_jobs} Collect Tweet Jobs to finish..."
  sleep(10)		
end

members.each do |member|
  if Person.find_by_username(member) != nil
    person = Person.find_by_username(member) 
    person.feed_entries.each do |feed_entry|
      if feed_entry.retweet_count.to_i > 0 && feed_entry.retweet_ids == [] # Only collect retweets for those that have made retweets but where we dont have them
        #puts "enque person #{feed_entry.id}"      
        Delayed::Job.enqueue(CollectRetweetIdsForEntryJob.new(feed_entry.id))               
      end
    end
  else
    puts "there is no such person #{member}"
  end
end